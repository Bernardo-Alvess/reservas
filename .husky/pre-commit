#!/bin/sh
set -e

# Executa o lint-staged
echo "ğŸ” Executando lint-staged..."
yarn lint-staged

# Verifica secrets com GitLeaks
echo "ğŸ” Verificando secrets com GitLeaks antes do commit..."

# Rodando o GitLeaks e capturando a saÃ­da JSON
LEAKS=$(gitleaks detect --redact --report-format=json --no-git --report-path=gitleaks-report.json --config=.gitleaks.toml --exit-code 1)

# Verifica se hÃ¡ leaks
if [ -n "$LEAKS" ] && [ "$LEAKS" != "[]" ]; then
  echo "ğŸš¨ GitLeaks encontrou segredos! Commit bloqueado."
  exit 1
else
  echo "âœ… Nenhum segredo encontrado. Commit permitido."
fi
